# 通知表示詳細マトリックス

## 1. 重要エラー通知 (通知レベル非依存)

以下の通知は通知レベル設定(詳細/標準/エラーのみ)に**依存せず、常に表示される**。
同期失敗の原因をユーザが認知できなければ問題の解決が不可能なため、すべてのレベルで表示を保証する。

`executeSmartSync` の catch ブロックでエラー種別を判定し、適切な通知キーを選択する:

| エラー種別       | 判定条件                                                      | 通知キー                 |
| :--------------- | :------------------------------------------------------------ | :----------------------- |
| 認証エラー       | "Not authenticated" / "Authentication failed" を含む          | `noticeSyncFailedAuth`   |
| ネットワークエラー | "Network error" / "Failed to fetch" / "unreachable" を含む  | `noticeSyncFailedNetwork`|
| その他のエラー   | 上記以外                                                      | `noticeSyncFailed`       |

| 通知の種類                                                             | 初回同期 | 起動時同期 | 手動同期 | タイマー同期 | 保存時同期 | 編集時同期 | レイアウト変更時同期 | フルスキャン |
| :--------------------------------------------------------------------- | :------: | :--------: | :------: | :----------: | :--------: | :--------: | :------------------: | :----------: |
| `❌ [同期] 未認証です。設定画面からログインしてください。`              |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |
| `❌ [同期] ネットワークエラー。接続を確認してもう一度お試しください。`  |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |
| `❌ [同期] 同期失敗: {0}`                                               |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |

**実装:** `notification-matrix.ts` の `ALWAYS_SHOW` セットに登録。`shouldShowNotification` で通知レベルが「エラーのみ」でもこのセットに該当するキーはバイパスされる。

## 2. ケース別表示マトリックス (通知レベル依存)

`表示`: ユーザへ通知する
`非表示`: ユーザへ通知しない(ログには残す)
`-`: No care

### すべて表示(詳細)

| 通知の種類                                                                       | 初回同期 | 起動時同期 | 手動同期 | タイマー同期 | 保存時同期 | 編集時同期 | レイアウト変更時同期 | フルスキャン | Push時競合検出 | Pull時競合検出 | 認証 | 履歴モーダル | E2EEモーダル |
| :------------------------------------------------------------------------------- | :------: | :--------: | :------: | :----------: | :--------: | :--------: | :------------------: | :----------: | :------------: | :------------: | :--: | :----------: | :----------: |
| `⚡ [同期] 処理開始...`                                                          |   表示   |   非表示   |   表示   |    非表示    |   非表示   |   非表示   |        非表示        |     表示     |       -        |       -        |  -   |      -       |      -       |
| `🔍️ [同期] ローカルファイルを走査中...`                                          |   表示   |   非表示   |    -     |      -       |     -      |     -      |          -           |     表示     |       -        |       -        |  -   |      -       |      -       |
| `⌛️ [同期] リモート側の反映完了を待機中...`                                      |   表示   |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `📥 [同期] ダウンロード中 {file}`                                                |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [同期] ダウンロード完了 (x files)`                                           |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📤 [同期] アップロード中 {file}`                                                |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [同期] アップロード完了 (x files)`                                           |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `✅ [同期] すべて最新の状態です`                                                 |   表示   |    表示    |   表示   |    非表示    |   非表示   |   非表示   |        非表示        |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📝 [同期] 正常にアップロード出来たか確認中...`                                  |   表示   |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `✅ [同期] 成功 {file}`                                                          |   表示   |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `🗑️ [同期] 削除 {file}`                                                          |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `✏️ [同期] リネーム反映 {file}`                                                  |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📂 [同期] 移動反映 {file}`                                                      |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📝 [競合] マージ中: {file}`                                                     |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [競合] 自動解決されました: {file}`                                           |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⚠️ [競合] ローカル版を保護し、リモート版を反映しました: {file}`                 |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⚠️ [競合] リモート版を保護し、ローカル版を反映しました: {file}`                 |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⚠️ [競合] マージに失敗した可能性が有ります。詳細は他デバイスを確認してください` |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⌛️ [競合] 他デバイスが解決するのを待機しています...: {file}`                    |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [競合] 他デバイスの解決結果を反映しました: {file}`                           |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [認証] 成功！`                                                               |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        | 表示 |      -       |      -       |
| `❌ [認証] 失敗`                                                                 |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        | 表示 |      -       |      -       |
| `✅ [履歴] 無期限保護設定完了`                                                   |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `❌ [履歴] クラウド側の仕様により、無期限保存設定を解除することはできません。`   |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `💾 [履歴] ファイルを復元しました`                                               |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `💾 [履歴] 別名で復元しました: {file}`                                           |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `🗑️ [履歴] リビジョンを削除しました`                                             |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `🚀 [E2EE] 移行を開始しました...`                                                |    -     |     -      |   表示   |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `✅ [E2EE] 移行完了！`                                                            |    -     |     -      |   表示   |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `❌ [E2EE] 移行失敗`                                                              |    -     |     -      |   表示   |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `🔒 [E2EE] Vaultがロック中のため同期を一時停止しています。`                       |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `🔒 [E2EE] このVaultは暗号化されています。パスワードを入力してください。`          |    -     |    表示    |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `❌ [E2EE] エンジンの検証に失敗しました。`                                        |    -     |    表示    |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `ロック解除しました！`                                                             |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `パスワードが正しくありません。`                                                   |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `✅ [E2EE] 暗号化パスワードを変更しました。`                                       |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `✅ [E2EE] リカバリーコードでVaultを復元しました。`                                |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `❌ [E2EE] 復号に失敗しました。パスワードが間違っているか、データが破損しています。` |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |

**備考: `noticeVaultLocked` の表示抑制ルール**

- 手動同期・フルスキャン: ユーザーの明示的操作のため、毎回表示する
- 自動トリガー(タイマー/保存/編集/レイアウト/起動時/初回): 初回のみ表示し、以降はロック解除まで抑制する

### 標準

| 通知の種類                                                                       | 初回同期 | 起動時同期 | 手動同期 | タイマー同期 | 保存時同期 | 編集時同期 | レイアウト変更時同期 | フルスキャン | Push時競合検出 | Pull時競合検出 | 認証 | 履歴モーダル | E2EEモーダル |
| :------------------------------------------------------------------------------- | :------: | :--------: | :------: | :----------: | :--------: | :--------: | :------------------: | :----------: | :------------: | :------------: | :--: | :----------: | :----------: |
| `⚡ [同期] 処理開始...`                                                          |   表示   |   非表示   |   表示   |    非表示    |   非表示   |   非表示   |        非表示        |     表示     |       -        |       -        |  -   |      -       |      -       |
| `🔍️ [同期] ローカルファイルを走査中...`                                          |   表示   |   非表示   |    -     |      -       |     -      |     -      |          -           |     表示     |       -        |       -        |  -   |      -       |      -       |
| `⌛️ [同期] リモート側の反映完了を待機中...`                                      |   表示   |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `📥 [同期] ダウンロード中 {file}`                                                |   表示   |   非表示   |  非表示  |    非表示    |   非表示   |   非表示   |        非表示        |     表示     |     非表示     |     非表示     |  -   |      -       |      -       |
| `✅ [同期] ダウンロード完了 (x files)`                                           |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📤 [同期] アップロード中 {file}`                                                |   表示   |   非表示   |  非表示  |    非表示    |   非表示   |   非表示   |        非表示        |     表示     |     非表示     |     非表示     |  -   |      -       |      -       |
| `✅ [同期] アップロード完了 (x files)`                                           |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `✅ [同期] すべて最新の状態です`                                                 |   表示   |    表示    |   表示   |    非表示    |   非表示   |   非表示   |        非表示        |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📝 [同期] 正常にアップロード出来たか確認中...`                                  |   表示   |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `✅ [同期] 成功 {file}`                                                          |   表示   |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `🗑️ [同期] 削除 {file}`                                                          |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `✏️ [同期] リネーム反映 {file}`                                                  |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📂 [同期] 移動反映 {file}`                                                      |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `📝 [競合] マージ中: {file}`                                                     |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [競合] 自動解決されました: {file}`                                           |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⚠️ [競合] ローカル版を保護し、リモート版を反映しました: {file}`                 |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⚠️ [競合] リモート版を保護し、ローカル版を反映しました: {file}`                 |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⚠️ [競合] マージに失敗した可能性が有ります。詳細は他デバイスを確認してください` |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `⌛️ [競合] 他デバイスが解決するのを待機しています...: {file}`                    |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [競合] 他デバイスの解決結果を反映しました: {file}`                           |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |      表示      |      表示      |  -   |      -       |      -       |
| `✅ [認証] 成功！`                                                               |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        | 表示 |      -       |      -       |
| `❌ [認証] 失敗`                                                                 |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        | 表示 |      -       |      -       |
| `✅ [履歴] 無期限保護設定完了`                                                   |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `❌ [履歴] クラウド側の仕様により、無期限保存設定を解除することはできません。`   |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `💾 [履歴] ファイルを復元しました`                                               |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `💾 [履歴] 別名で復元しました: {file}`                                           |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `🗑️ [履歴] リビジョンを削除しました`                                             |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |     表示     |      -       |
| `🚀 [E2EE] 移行を開始しました...`                                                |    -     |     -      |   表示   |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `✅ [E2EE] 移行完了！`                                                            |    -     |     -      |   表示   |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `❌ [E2EE] 移行失敗`                                                              |    -     |     -      |   表示   |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `🔒 [E2EE] Vaultがロック中のため同期を一時停止しています。`                       |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |
| `🔒 [E2EE] このVaultは暗号化されています。パスワードを入力してください。`          |    -     |    表示    |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `❌ [E2EE] エンジンの検証に失敗しました。`                                        |    -     |    表示    |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |      -       |
| `ロック解除しました！`                                                             |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `パスワードが正しくありません。`                                                   |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `✅ [E2EE] 暗号化パスワードを変更しました。`                                       |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `✅ [E2EE] リカバリーコードでVaultを復元しました。`                                |    -     |     -      |    -     |      -       |     -      |     -      |          -           |      -       |       -        |       -        |  -   |      -       |     表示     |
| `❌ [E2EE] 復号に失敗しました。パスワードが間違っているか、データが破損しています。` |   表示   |    表示    |   表示   |     表示     |    表示    |    表示    |         表示         |     表示     |       -        |       -        |  -   |      -       |      -       |

**備考: `noticeVaultLocked` の表示抑制ルール**

- 手動同期・フルスキャン: ユーザーの明示的操作のため、毎回表示する
- 自動トリガー(タイマー/保存/編集/レイアウト/起動時/初回): 初回のみ表示し、以降はロック解除まで抑制する

## 3. 通知機能以外の機能を用いたユーザへの状態通知

| 通知の種類                 |     初回同期     |    起動時同期    |     手動同期     |         保存時同期          |          自動同期           |   フルスキャン   | Push時競合検出 | Pull時競合検出 | 認証 | 履歴モーダル |
| :------------------------- | :--------------: | :--------------: | :--------------: | :-------------------------: | :-------------------------: | :--------------: | :------------: | :------------: | :--: | :----------: |
| リボンボタンのアイコン回転 | 最初から最後まで | 最初から最後まで | 最初から最後まで | Push/Pull対象がある場合のみ | Push/Pull対象がある場合のみ | 最初から最後まで |       -        |       -        |  -   |      -       |
| モバイル専用インジケーター | 最初から最後まで | 最初から最後まで | 最初から最後まで | Push/Pull対象がある場合のみ | Push/Pull対象がある場合のみ | 最初から最後まで |       -        |       -        |  -   |      -       |
